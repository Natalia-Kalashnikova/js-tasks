{"version":3,"file":"commonHelpers2.js","sources":["../src/js/lesson-22.js"],"sourcesContent":["// ********************* Практика ********************* \\\\\n// Створи додаток для туристичного агенства\n// Користувач має форму в яку може додавати довільну кількість полів\n// В кожне поле він вводить назву країни\n// Після сабміту форми форма відправляє запит на бекенд та отримує назви столиць цих країн\n// На основі відповіді попереднього сервісу потрібно створити прогноз погоди по кожній столиці\n// Використовуй паралельні запити\n// Бекенд для пошуку країн https://restcountries.com/\n// Бекенд для прогнозу погоди  https://www.weatherapi.com/docs/   КЛЮЧ ВАЛІДНИЙ 21 ДЕНЬ !!!!!\n\n// Приклад роботи https://ibb.co/6g3YYs8\n\nconst elements = {\n  form: document.querySelector(\".js-search\"),\n  formContainer: document.querySelector(\".js-form-container\"),\n  list: document.querySelector(\".js-list\"),\n  addField: document.querySelector(\".js-add\"),\n  removeField: document.querySelector(\".js-remove\"),\n};\n\nelements.addField.addEventListener(\"click\", handlerAddField);\nelements.removeField.addEventListener(\"click\", handlerRemoveField);\nelements.form.addEventListener(\"submit\", handlerSearch);\n\nasync function handlerSearch(evt) {\n  evt.preventDefault();\n\n  const formData = new FormData(evt.currentTarget);\n  const countries = formData.getAll(\"country\");\n\n  try {\n    const capitals = await serviceGetCountries(countries);\n    const weather = await serviceGetWeather(capitals);\n\n    elements.list.innerHTML = createMarkup(weather);\n  } catch (err) {\n    console.log(err);\n  } finally {\n    elements.formContainer.innerHTML = '<input type=\"text\" name=\"country\" />';\n  }\n}\n\nasync function serviceGetCountries(arr) {\n  const promises = arr.map(async (country) => {\n    const resp = await fetch(`https://restcountries.com/v3.1/name/${country}`);\n    if (!resp.ok) {\n      throw new Error(resp.statusText);\n    }\n\n    return resp.json();\n  });\n\n  const data = await Promise.allSettled(promises);\n  console.log(data);\n  return data\n    .filter(({ status }) => status === \"fulfilled\")\n    .map(({ value }) => value[0].capital[0]);\n}\n\nfunction handlerAddField() {\n  elements.formContainer.insertAdjacentHTML(\n    \"beforeend\",\n    ' <input type=\"text\" name=\"country\" />'\n  );\n}\n\nfunction handlerRemoveField() {\n  const { children, lastElementChild } = elements.formContainer;\n\n  if (children.length === 1) {\n    return;\n  }\n\n  lastElementChild.remove();\n}\nasync function serviceGetWeather(arr) {\n  const API_KEY = \"61069fb8abf74210b7d232148231510\";\n  const BASE_URL = \"http://api.weatherapi.com/v1\";\n  const END_POINT = \"/current.json\";\n\n  const promises = arr.map(async (capital) => {\n    const params = new URLSearchParams({\n      key: API_KEY,\n      q: capital,\n      lang: \"uk\",\n    });\n    const resp = await fetch(`${BASE_URL}${END_POINT}?${params}`);\n\n    if (!resp.ok) {\n      throw new Error(resp.statusText);\n    }\n    return resp.json();\n  });\n\n  const data = await Promise.allSettled(promises);\n  return data\n    .filter(({ status }) => status === \"fulfilled\")\n    .map(\n      ({\n        value: {\n          location: { country, name },\n          current: {\n            temp_c,\n            condition: { icon, text },\n          },\n        },\n      }) => {\n        return { country, name, temp_c, icon, text };\n      }\n    );\n}\n\nfunction createMarkup(arr) {\n  return arr\n    .map(\n      ({ country, name, temp_c, icon, text }) => `\n    <li>\n        <img src=\"${icon}\" alt=\"${text}\" />\n        <h2>${country}</h2>\n        <h2>${name}</h2>\n        <p>${text}</p>\n        <p class=\"temp\">${temp_c} °C</p>\n    </li>\n  `\n    )\n    .join(\"\");\n}\n\nfetch(\"https://api.thecatapi.com/v1/breeds\");\n\nconst options = {\n  headers: {\n    \"x-api-key\":\n      \"live_ww4AjjgEJMWPZXfckgLikrYHKpCfRciUJxnZ3R7b8EHrjMK3j5ILPlmEMa66XbNy\",\n  },\n};\nfetch(`https://api.thecatapi.com/v1/images/search?breed_ids=abys`, options);"],"names":["elements","handlerAddField","handlerRemoveField","handlerSearch","evt","countries","capitals","serviceGetCountries","weather","serviceGetWeather","createMarkup","err","arr","promises","country","resp","data","status","value","children","lastElementChild","API_KEY","BASE_URL","END_POINT","capital","params","name","temp_c","icon","text","options"],"mappings":"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"}